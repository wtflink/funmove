{% load staticfiles %}


<html>
<head>
	<title>放心搬，解決你在外搬宿的困擾</title>
	<meta charset='utf-8' name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="{% static "css/base.css" %}">
	<link rel="stylesheet" href="{% static "css/jquery-ui-timepicker-addon.css" %}">
	<link rel="stylesheet" href="{% static "bootstrap/css/bootstrap-theme.css" %}">
	<link rel="stylesheet" href="{% static "bootstrap/css/bootstrap.css" %}">
	<link rel="stylesheet" href="{% static "sidr/css/jquery.sidr.dark.css" %}">
	<link rel="stylesheet" href="{% static "css/home.css" %}">
	<link rel="stylesheet" href="{% static "css/order.css" %}">
	<link rel="stylesheet" href="{% static "js/bubbletip/bubbletip.css" %}">
	<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/themes/hot-sneaks/jquery-ui.css" rel="stylesheet">
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
	<script type="text/javascript" src="{% static "js/jquery-ui-timepicker-addon.js" %}"></script>	
	<link href="{% static "fullcalendar/fullcalendar.css" %}" rel='stylesheet' />
	<link href="{% static "fullcalendar/fullcalendar.print.css" %}" rel='stylesheet' media='print' />
	<script src="{% static "fullcalendar/lib/moment.min.js" %}"></script>
	<script src="{% static "fullcalendar/fullcalendar.min.js" %}"></script>
	<script src="{% static "bootstrap/js/bootstrap.min.js" %}"></script>
	<script src="{% static "sidr/js/jquery.sidr.min.js" %}"></script>	
	<script src="{% static "js/base.js" %}"></script> 
	<script src="{% static "js/home.js" %}"></script>	
	<script src="{% static "js/order.js" %}"></script>
	<script src="{% static "js/jQuery.bubbletip-1.0.6.js" %}"></script>	

	<style>
		article,aside,figure,figcaption,footer,header,hgroup,menu,nav,section {display:block;}
		body {
			font: 62.5% "微軟正黑體";
			margin-top: 10px;
			padding: 0;
			overflow:hidden;
		}		

	</style>
	
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBxwkpuZ751y6h6JL8cVM1c9VdAnWhnEa0"></script>
	
<script type="text/javascript">
  var directionsDisplay;
  var directionsService = new google.maps.DirectionsService();
  var map;
  var oldDirections = [];
  var currentDirections = null; 
  var start;
  var end;

      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(22.992, 120.222) ,
          zoom: 14,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(
            document.getElementById('map-canvas'),
            mapOptions);

		directionsDisplay = new google.maps.DirectionsRenderer({
	        'map': map,
	        'preserveViewport': true,
	        'draggable': true
	    });

	    google.maps.event.addListener(directionsDisplay, 'directions_changed',
	      function() {
	        if (currentDirections) {
	          oldDirections.push(currentDirections);
	        }
	        currentDirections = directionsDisplay.getDirections();
	        computeTotalDistance(currentDirections);
	      });

	    calcRoute();
      }

  function calcRoute() {
    start = '台南市東區大學路1號';
    end = '台南市東區北門路';
    var request = {
        origin:start,
        destination:end,
        travelMode: google.maps.DirectionsTravelMode.DRIVING
    };
    directionsService.route(request, function(response, status) {
      if (status == google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(response);
      }
    });
  }

function computeTotalDistance(result) {
  var total = 0;
  var myroute = result.routes[0];
  var driveTime = myroute.legs[0].duration.value/60;
  var wholeTime = (driveTime + 15)/30 - 0.8;
  var willTime = (Math.ceil(wholeTime) + 1)*30 ;
  var willHr = willTime/60;
  var willMin = 0;
  var dollar = 0;
  for (var i = 0; i < myroute.legs.length; i++) {
    total += myroute.legs[i].distance.value;
  }
  total = total / 1000;
  document.getElementById("id_departure").value = myroute.legs[0].start_address;
  document.getElementById("id_destination").value = myroute.legs[0].end_address;
  document.getElementById('total').innerHTML = "行程距離: " + total + ' km';
  document.getElementById('time').innerHTML = "預估行程時間: " + myroute.legs[0].duration.text ;
  document.getElementById('hint').innerHTML = "估計行車距離: " + total + ' 公里<br>估計行車時間: ' + myroute.legs[0].duration.text + "<br>建議預約時間: " + willHr + "小時" ;
}

function initialize2(pFrom,pEnd) {
	var request = {
        origin:pFrom,
        destination:pEnd,
        travelMode: google.maps.DirectionsTravelMode.DRIVING
    };
    directionsService.route(request, function(response, status) {
      if (status == google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(response);
        currentDirections = directionsDisplay.getDirections();
	    computeTotalDistance(currentDirections);
      }
    });
}	

</script>

			
</head>
<body onload="initialize()" onDRAGSTART="window.event.returnValue=false" onCONTEXTMENU="window.event.returnValue=false" onSelectStart="event.returnValue=false">
	<header>
			<div id="mobile-header">

			    <a id="responsive-menu-button" href="#sidr-main">
			    	<img src="{% static "images/menu-icon.png" %}"/>
			    </a>
			</div>
			<div id="navigation">
				    <nav class="navbar navbar-fixed-top navbar-background">
				    	<div class="navbar-header">
				    		<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false">
						        <span class="sr-only">Toggle navigation</span>
						        <span class="icon-bar"></span>
							    <span class="icon-bar"></span>
							    <span class="icon-bar"></span>
						    </button>
						    <a class="navbar-brand" href="../when/">Funmove放心搬</a>
				    	</div>
				    	<div class="navbar-collapse collapse" id="navbar-collapse-1">
				    		<ul class="nav navbar-nav navbar-left">
				    		<li>
				    			<!--
				    			<a href="#download">
				    				<img src="/static/images/menu-icon.png" />
				    			</a>
				    			-->
				    		</li>
				    		</ul>
				    		<ul class="nav navbar-nav navbar-right">
					            <li><a href="../when">我要放心搬</a></li>
					            <li><a href="#usage" id="cont">訂單查詢</a></li>
					            <li><a href="#documentation">與我們聯絡</a></li>
					            
				        	</ul>
				    	</div>
				    </nav>
    		</div>

	</header>	
	<div id="navigation_bottom"></div>
	<article>
	<div id="form_page">
	<div class="container">

            <form name="funmove" action="" method="POST">{% csrf_token %}
                <p>{{ form.non_field_errors }}</p>
				<div class="">
					<!---- Map Data---->
					<section id="map">
						<div class="row">
							<div id="map-canvas"></div>
							<div class="decorateForm">
								{{ form.departure.errors }}
								<label for="id_departure">起始地:</label>
								{{ form.departure }}<br>

								{{ form.destination.errors }}
								<label for="id_destination">目的地:</label>
								{{ form.destination }}
									
								<br>
								<div class="row">
									<div class="col-md-3 "></div>
									<div class="col-md-6 yesPos">
										<input onclick="initialize2(id_departure.value,id_destination.value)" class="btn btn-info btn-sm" type="button" value="確認地點">
									</div>
									<div class="col-md-3 "></div>
								</div>
								<div id="total"></div>
								<div id="time"></div>
								<div class="row">
									<div class="col-md-3 "></div>
									<div class="col-md-6 checkPos">
										<input class="btn btn-primary btn1" type="button" value="NEXT">
									</div>
									<div class="col-md-3 "></div>
								</div>
							</div>
							
						</div>	
					</section>

					<!---- Main Data---->
					<section id="main">
						<div class="row content">
						<div class="row">
							<div class="col-md-4 col-xs-4"></div>			
							<div class="col-md-4 col-xs-4">	
								<div class="col-centered"><button class="btn btn-primary btn3 btnDirection" type="button">PREV</button></div>	
							</div>	
							<div class="col-md-4 col-xs-4"></div>					
						</div>
						<div class="row">
							<div class="col-md-6 col-xs-6 col-sm-6">
								<div class="decorateForm ">
									{{ form.reservation_date.errors }}
									<label for="id_reservation_date">服務日期:</label>
									{{ form.reservation_date }}<br>

									{{ form.reservation_time.errors }}
									<label for="id_reservation_time">起始時間:</label>
									{{ form.reservation_time }}<br>

									<div id="hint"></div>

									{{ form.time_needed_hr.errors }}
									<label for="id_time_needed_hr">使用服務時間(小時):</label>
									{{form.time_needed_hr}}

									{{ form.time_needed_min.errors }}
									<label for="id_time_needed_min">使用服務時間(分鐘):</label>
									{{form.time_needed_min}}
									<div id="dollar">所需費用: 0元</div><div id="priceHelp">?</div>
								</div>
							</div>
							<div class="col-md-6 col-xs-6 col-sm-6">
								<div id='calendar'></div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-4 col-xs-4"></div>
							<div class="col-md-4 col-xs-4">
								<div class="col-centered"><button class="btn btn-primary btn2 btnDirection" type="button">NEXT</button></div>
							</div>
							<div class="col-md-4 col-xs-4"></div>
						</div>
						</div>
					</section>

					<!---- User Data---->
					<section id="user">
						<div class="row content">
						<div class="row">
							<div class="col-md-4 col-xs-4"></div>
							<div class="col-md-4 col-xs-4">
								<div class="col-centered"><button class="btn btn-primary btn1 btnDirection" type="button">PREV</button></div>
							</div>
							<div class="col-md-4 col-xs-4"></div>
						</div>
						<div class="row">
							<div class="decorateForm col-centered">
							<div class="col-md-6 col-xs-6 col-sm-6">
								
									{{ form.name.errors }}
									<label for="id_name">姓名:</label>
									{{ form.name }}<div id="vali_name"></div><br>

									{{ form.email.errors }}
									<label for="id_email">Email:</label>
									{{ form.email }}<div id="vali_email"></div><br>

									{{ form.cell_phone.errors }}
									<label for="id_cell_phone">手機號碼:</label>
									{{ form.cell_phone }}<div id="vali_phone"></div><br>

									{{ form.birth_year.errors }}
									<label for="id_birth_year">生日:</label>
									<p>西元 {{ form.birth_year }}年
									{{ form.birth_month.errors }}
									{{ form.birth_month }}月
									{{ form.birth_day.errors }}
									{{ form.birth_day }}日</p>
									

								
							</div>
							<div class="col-md-6 col-xs-6 col-sm-6">
								<label for="id_remarks">備註:</label><br>
								{{ form.remarks}}
							</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-4 col-xs-4"></div>
							<div class="col-md-4 col-xs-4">
								<div class="col-centered"><button onclick="cacheData()" class="btn btn-primary btn4 btnDirection" type="button">NEXT</button></div>
							</div>
							<div class="col-md-4 col-xs-4"></div>
						</div>
						</div>
				    </div>

				    </section>

				    <!---- 確認資料---->
				    <section id="verify">
				    	<div class="row content">
				    	<div class="row verifyTitle">
							<h1>確認資料</h1>
							<hr>
						</div>
				    	<div class="row">
				    		
				    			<div class="row">	
									<div class="userData col-centered">
										<div class="row">
											<div class="col-md-6 col-xs-6 col-sm-6">
												<div id="departure"></div>
												<div id="destination"></div>
												<div id="reservation_date"></div>											
												<div id="time_needed"></div>
											</div>
											<div class="col-md-6 col-xs-6 col-sm-6">
												<div id="user_name"></div>
												<div id="user_email"></div>
												<div id="user_cellphone"></div>
												<div id="user_birth"></div>
											</div>
										</div>	
										<div class="row">
											<div class="col-md-12 col-xs-12 col-sm-12">
												<div id="remarks"></div>
											</div>
										</div>
										<div class="row">	
											<br>
											<div id="price" style="float:right;"></div>
											<br>
										</div>	
									</div>	
								</div>		
								<div class="row">	    			
		                			<div class="col-md-4"></div>
			                		<div class="col-md-4">
			                			<div class="row col-centered last-btn">
			                				<div class="row">
					                			<div class="col-md-4 col-xs-4 col-sm-4">
					                				<button class="btn btn-primary btn2 btnDirection" type="button">PREV</button>
					                			</div>
					                			<div class="col-md-4 col-xs-4 col-sm-4">
					                				<button class="btn btn-warning btn3" type="button">重新檢查</button>
					                			</div>
					                			<div class="col-md-4 col-xs-4 col-sm-4">
					                				<button class="btn btn-success " onClick="checkForm()" type="button">確認送出</button>
					                			</div>
					                		</div>
			                			</div>
			                		</div>
			                		<div class="col-md-4"></div>	
								</div>
							
	                	</div>
	                	</div>
					</section>
					<section id="warning">
						<div class="row content">
							<p>很抱歉，我們的服務網頁目前並不支援您的螢幕解析度，敬請見諒！</p><br>
							<p>請使用電腦瀏覽器以取得網頁最佳瀏覽品質，謝謝您的配合！</p>
						</div>
					</section>	
            </form>
            
            
	</div>	

	
	</div>
	</article>

	<div id="priceTip">
		親愛的使用者 您好，放心搬目前為試營運階段，<br>
		計價方面為以下說明：<br>
		<br>
		放心搬以【30分鐘】為【1單位】做收費基準，<br>
		每單位費用為【300元】整。<br>
		<br>
		範例：今日我從「出發地把東西搬上車」直到<br>
		「目的地把東西搬下車」這樣的過程可能需要45分鐘，<br>
		因此我可以向放心搬預約『2個單位』共60分鐘<br>
		的服務時間，因此我的費用為600元整。<br>
		<br>
		計價方案未來將調整更有利於使用者的計價方式，敬請期待！
	</div>

	<div id="mapTip">
		請先拖曳地圖上的A、B兩點到您所指定的位置<br>
		A為起始地，B為目的地<br>
		或者直接在起始地與目的地兩個欄位打上您所指定正確的住址<br>
		別忘了，確定地點之後，記得按下「確認地點」按鈕<br>
		以利於後續訂單進行喔！
	</div>	

	<div id="contTip">
		功能更新中，敬請見諒！
	</div>	

	<footer class="footer_section">
		<div class="row">
			
		</div>
	</footer>	
</body>

</html>